<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Dashboard - Risk-Based Auth</title>
    <meta name="description" content="User dashboard for file management and profile settings">
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="animated-bg"></div>

    <!-- Navbar -->
    <nav class="navbar">
        <div class="navbar-content">
            <div class="navbar-brand">üîê User Dashboard</div>
            <div class="navbar-menu">
                <span id="userEmail" style="color: var(--text-secondary);"></span>
                <button class="btn btn-secondary" onclick="logout()">Logout</button>
            </div>
        </div>
    </nav>

    <div class="container" style="margin-top: 2rem;">
        <!-- Statistics -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="filesCount">0</div>
                <div class="stat-label">üìÅ Files Uploaded</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="storageUsed">0 MB</div>
                <div class="stat-label">üíæ Storage Used</div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="card" style="margin-bottom: 2rem;">
            <div
                style="display: flex; gap: 1rem; border-bottom: 1px solid var(--border-color); padding-bottom: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
                <button id="filesTabBtn" class="btn btn-primary" onclick="showTab('files')">My Files</button>
                <button id="sharedTabBtn" class="btn btn-secondary" onclick="showTab('shared')">Shared Files</button>
                <button id="mfaTabBtn" class="btn btn-secondary" onclick="showTab('mfa')">MFA Settings</button>
                <button id="passwordTabBtn" class="btn btn-secondary" onclick="showTab('password')">Reset
                    Password</button>
                <button id="feedbackTabBtn" class="btn btn-secondary" onclick="showTab('feedback')">Feedback</button>
            </div>

            <!-- Files Tab -->
            <div id="filesTab">
                <div style="margin-bottom: 1.5rem;">
                    <h3 class="card-title">Upload File</h3>
                    <form id="uploadForm" onsubmit="handleUpload(event)" style="margin-top: 1rem;">
                        <div style="display: flex; gap: 1rem; align-items: flex-end;">
                            <div class="form-group" style="flex: 1; margin-bottom: 0;">
                                <input type="file" class="form-input" id="fileInput" required>
                            </div>
                            <button type="submit" class="btn btn-success">üì§ Upload</button>
                        </div>
                    </form>
                </div>

                <h3 class="card-title" style="margin-bottom: 1rem;">My Files</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>File Name</th>
                                <th>Size</th>
                                <th>Uploaded</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="filesTableBody">
                            <tr>
                                <td colspan="4" style="text-align: center; color: var(--text-muted);">Loading...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Shared Files Tab -->
            <div id="sharedTab" class="hidden">
                <h3 class="card-title" style="margin-bottom: 1rem;">Files Shared With Me</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>File Name</th>
                                <th>Owner</th>
                                <th>Size</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="sharedFilesTableBody">
                            <tr>
                                <td colspan="4" style="text-align: center; color: var(--text-muted);">Loading...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- MFA Tab -->
            <div id="mfaTab" class="hidden">
                <h3 class="card-title" style="margin-bottom: 1rem;">Update MFA Settings</h3>
                <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                    Register your email address for OTP-based multi-factor authentication.
                </p>
                <form id="mfaForm" onsubmit="handleMFAUpdate(event)">
                    <div class="form-group">
                        <label class="form-label">OTP Email</label>
                        <input type="email" class="form-input" id="otpEmailUpdate" placeholder="Enter email for OTP">
                        <p style="font-size: 0.85rem; color: var(--text-muted); margin-top: 0.5rem;">
                            Current: <span id="currentOtpEmail" style="font-weight: 600;">Not set</span>
                        </p>
                    </div>

                    <div style="display: flex; gap: 1rem;">
                        <button type="submit" class="btn btn-primary" style="flex: 1;">Update MFA</button>
                        <button type="button" class="btn btn-secondary" onclick="resetMFAForm()"
                            style="flex: 1;">Reset</button>
                    </div>
                </form>
            </div>

            <!-- Reset Password Tab -->
            <div id="passwordTab" class="hidden">
                <h3 class="card-title" style="margin-bottom: 1rem;">Reset Password</h3>
                <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                    Change your account password by entering your current password and a new password.
                </p>
                <form id="passwordForm" onsubmit="handlePasswordReset(event)">
                    <div class="form-group">
                        <label class="form-label">Current Password</label>
                        <input type="password" class="form-input" id="currentPassword"
                            placeholder="Enter current password" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">New Password</label>
                        <input type="password" class="form-input" id="newPassword" placeholder="Enter new password"
                            required minlength="6">
                        <p style="font-size: 0.85rem; color: var(--text-muted); margin-top: 0.5rem;">
                            Password must be at least 6 characters long
                        </p>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Confirm New Password</label>
                        <input type="password" class="form-input" id="confirmPassword"
                            placeholder="Confirm new password" required minlength="6">
                    </div>

                    <div style="display: flex; gap: 1rem;">
                        <button type="submit" class="btn btn-primary" style="flex: 1;">Reset Password</button>
                        <button type="button" class="btn btn-secondary" onclick="resetPasswordForm()"
                            style="flex: 1;">Clear</button>
                    </div>
                </form>
            </div>

            <!-- Feedback Tab -->
            <div id="feedbackTab" class="hidden">
                <h3 class="card-title" style="margin-bottom: 1rem;">Send Feedback to Admin</h3>
                <form id="feedbackForm" onsubmit="handleFeedback(event)">
                    <div class="form-group">
                        <label class="form-label">Your Feedback</label>
                        <textarea class="form-input" id="feedbackMessage" rows="5" placeholder="Enter your feedback..."
                            required></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Send Feedback</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Share Modal -->
    <div class="modal" id="shareModal">
        <div class="modal-content">
            <h2 class="card-title">Share File</h2>
            <p style="color: var(--text-secondary); margin: 1rem 0;">Select users to share with</p>

            <div id="usersList" style="max-height: 300px; overflow-y: auto; margin: 1rem 0;"></div>

            <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                <button class="btn btn-secondary" style="flex: 1;" onclick="closeShareModal()">Cancel</button>
                <button class="btn btn-primary" style="flex: 1;" onclick="confirmShare()">Share</button>
            </div>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/user-dashboard.js"></script>
</body>

</html>